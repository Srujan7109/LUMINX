<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Virtual Classroom - Edunexus</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>

    <link rel="stylesheet" href="/css/style.css" />
  </head>
  <body>
    <div class="container">
      <div id="status" class="status disconnected">Disconnected</div>

      <div id="joinForm" class="header">
        <h1>ğŸ“ Virtual Classroom for Rural Areas</h1>
        <p style="margin: 10px 0; color: #666">Edunexus Prototype</p>
        <div class="join-form">
          <input
            type="text"
            id="nameInput"
            placeholder="Enter your name"
            required
          />
          <select id="roleSelect">
            <option value="student">Student</option>
            <option value="teacher">Teacher</option>
          </select>
          <button onclick="joinClassroom()">Join Classroom</button>
        </div>
      </div>

      <div id="classroom" class="classroom">
        <div class="main-content">
          <div class="slide-area" id="slideArea">
            <div id="noSlideMessage">
              <p style="color: #999; font-size: 18px">
                ğŸ“‹ Waiting for teacher to upload slides...
              </p>
            </div>
            <img
              id="currentSlide"
              class="slide-content hidden"
              alt="Current Slide"
              loading="lazy"
            />

            <div id="whiteboardContainer" class="whiteboard-container hidden">
              <canvas id="whiteboardCanvas" class="whiteboard-canvas"></canvas>

              <div id="whiteboardControls" class="whiteboard-controls hidden">
                <div
                  id="brushTool"
                  class="whiteboard-tool active"
                  title="Brush"
                >
                  âœï¸
                </div>
                <div id="eraserTool" class="whiteboard-tool" title="Eraser">
                  ğŸ§¹
                </div>
                <input
                  type="color"
                  id="colorPicker"
                  class="whiteboard-color-picker"
                  value="#000000"
                  title="Color"
                />
                <input
                  type="range"
                  id="sizeSlider"
                  class="whiteboard-size-slider"
                  min="1"
                  max="20"
                  value="3"
                  title="Brush Size"
                />
                <div
                  id="clearBoard"
                  class="whiteboard-tool"
                  title="Clear Board"
                >
                  ğŸ—‘ï¸
                </div>
              </div>

              <div id="whiteboardStatus" class="whiteboard-status">
                <span
                  id="syncIndicator"
                  class="whiteboard-sync-indicator synced"
                ></span>
                <span id="syncText">Synced</span>
              </div>
            </div>
          </div>

          <div class="slide-controls">
            <div class="slide-info">
              <span id="slideInfo">Slide 0 of 0</span>
            </div>

            <div id="teacherControls" class="teacher-controls">
              <input
                id="slideUpload"
                type="file"
                accept=".jpg,.jpeg,.png,.pdf,.pptx"
                style="display: none"
                onchange="handleFileUpload(event)"
              />
              <input
                id="resourceUpload"
                type="file"
                style="display: none"
                onchange="handleResourceUpload(event)"
              />

              <button class="upload-btn" onclick="triggerFileUpload()">
                ğŸ“¤ Upload Slide
              </button>
              <button class="prev-btn" onclick="previousSlide()">
                â¬…ï¸ Previous
              </button>
              <button class="next-btn" onclick="nextSlide()">â¡ï¸ Next</button>
              <button class="upload-btn" onclick="triggerResourceUpload()">
                ğŸ“¦ Upload Resource
              </button>
            </div>

            <div class="whiteboard-toggle-container">
              <button
                id="whiteboardToggle"
                class="whiteboard-toggle"
                onclick="toggleWhiteboard()"
              >
                ğŸ¨ Whiteboard
              </button>
            </div>
          </div>

          <div class="audio-controls">
            <button
              id="startAudioBtn"
              class="start-audio-btn"
              onclick="startAudio()"
            >
              ğŸ¤ Start Audio
            </button>
            <button
              id="stopAudioBtn"
              class="stop-audio-btn hidden"
              onclick="stopAudio()"
            >
              ğŸ”‡ Stop Audio
            </button>
            <div id="audioStatus" class="audio-status stopped">
              Audio: Stopped
            </div>
          </div>
        </div>

        <div class="sidebar">
          <div class="participants">
            <h3>ğŸ‘¥ Participants (<span id="participantCount">0</span>)</h3>
            <div id="participantsList"></div>
          </div>

          <div class="chat">
            <h3>ğŸ’¬ Chat</h3>
            <div id="chatMessages" class="chat-messages"></div>
            <div class="chat-input">
              <input
                type="text"
                id="chatInput"
                placeholder="Type a message..."
              />
              <button onclick="sendMessage()">Send</button>
            </div>
          </div>

          <div class="participants" style="margin-top: 16px">
            <h3>ğŸ“š Resources</h3>
            <div id="resourcesList"></div>
          </div>
        </div>
      </div>
    </div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.7.2/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/yjs@13.6.8/dist/yjs.js"></script>
<script src="/js/whiteboard.js"></script>
<script src="/js/app.js"></script>

    
   <script>
  document.addEventListener("DOMContentLoaded", () => {
    const name = localStorage.getItem("name");
    const role = localStorage.getItem("role");

    if (!name || !role) {
      alert("User info missing. Please login again.");
      window.location.href = "/";
      return;
    }

    console.log(`Auto-joining classroom as ${name} (${role})`);

    // Always show classroom
    document.getElementById("classroom").style.display = "block";

    // Update status
    const statusEl = document.getElementById("status");
    if (statusEl) {
      statusEl.textContent = `Connected as: ${name} (${role})`;
      statusEl.classList.remove("disconnected");
      statusEl.classList.add("connected");
    }

    // If youâ€™re using socket.io
    // socket.emit("join", { name, role });
  });
</script>


   
  </body>
</html>
